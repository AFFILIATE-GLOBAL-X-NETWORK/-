<!-- account_active.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global X - Premium Activation</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-gold: #FFD700;
            --gold-glow: rgba(255, 215, 0, 0.4);
            --gold-gradient: linear-gradient(135deg, #FFD700 0%, #B8860B 100%);
            --dark-bg: #050505;
            --card-bg: rgba(18, 18, 18, 0.7);
            --border-color: rgba(255, 215, 0, 0.15);
            --input-bg: rgba(255, 255, 255, 0.03);
            --text-muted: #888;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--dark-bg);
            color: #fff;
            font-family: 'Outfit', sans-serif;
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
            position: relative;
        }

        /* Ambient Background Glow */
        .bg-glow {
            position: absolute; width: 600px; height: 600px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.05) 0%, transparent 70%);
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: -1; animation: pulseGlow 8s infinite ease-in-out;
        }

        .container { width: 100%; max-width: 480px; padding: 20px; box-sizing: border-box; position: relative; z-index: 10; }

        /* --- Glass Card --- */
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--border-color);
            border-radius: 24px; padding: 40px 30px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.8);
            position: relative; overflow: hidden;
        }
        /* Top Accent Line */
        .glass-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px;
            background: var(--gold-gradient);
        }

        /* --- Typography --- */
        .header-area { text-align: center; margin-bottom: 35px; }
        .logo-icon { font-size: 32px; background: var(--gold-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }
        .title { font-size: 22px; font-weight: 800; color: #fff; letter-spacing: 1px; text-transform: uppercase; margin: 0; }
        .subtitle { font-size: 11px; color: var(--text-muted); letter-spacing: 2px; text-transform: uppercase; margin-top: 5px; }

        /* --- Premium Wallet Box --- */
        .wallet-container {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            border-radius: 16px; padding: 20px;
            margin-bottom: 30px; position: relative;
        }
        .wallet-label { font-size: 10px; color: var(--primary-gold); letter-spacing: 1px; margin-bottom: 8px; font-weight: 600; text-transform: uppercase; display: flex; justify-content: space-between; }
        
        .address-row {
            display: flex; align-items: center; justify-content: space-between;
            background: #0a0a0a; border: 1px solid #222;
            padding: 10px 12px; border-radius: 10px;
        }
        .wallet-text {
            font-family: 'Courier New', monospace; font-size: 13px; color: #ccc;
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 80%;
        }
        
        .copy-btn {
            background: var(--input-bg); border: 1px solid #333;
            color: var(--primary-gold); width: 35px; height: 35px;
            border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }
        .copy-btn:hover { background: var(--primary-gold); color: #000; box-shadow: 0 0 10px var(--gold-glow); }
        .copy-btn:active { transform: scale(0.95); }

        /* --- Form Inputs --- */
        .form-group { margin-bottom: 20px; }
        .form-label { font-size: 12px; color: var(--text-muted); margin-bottom: 8px; display: block; font-weight: 500; margin-left: 4px; }
        
        .input-box { position: relative; }
        .form-input, .form-select {
            width: 100%; padding: 16px 16px 16px 45px;
            background: var(--input-bg); border: 1px solid #222;
            border-radius: 12px; color: #fff; font-family: 'Outfit', sans-serif; font-size: 14px;
            box-sizing: border-box; transition: all 0.3s;
        }
        .input-icon {
            position: absolute; left: 16px; top: 50%; transform: translateY(-50%);
            color: #555; font-size: 16px; transition: 0.3s;
        }

        .form-input:focus, .form-select:focus {
            border-color: var(--primary-gold); outline: none; background: #080808;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.1);
        }
        .form-input:focus + .input-icon { color: var(--primary-gold); }

        /* Readonly Field */
        .form-input[readonly] { background: rgba(0,0,0,0.5); border-color: #222; color: #666; cursor: not-allowed; }

        /* --- Gold Action Button --- */
        .btn-gold {
            width: 100%; padding: 18px; border-radius: 12px; border: none;
            background: var(--gold-gradient); color: #000; font-weight: 800; font-size: 14px; letter-spacing: 1px;
            cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px;
        }
        .btn-gold:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(255, 215, 0, 0.25); }
        .btn-gold:active { transform: translateY(0); }

        /* --- Waiting Screen --- */
        #waitingScreen { display: none; text-align: center; animation: fadeIn 0.6s ease-out; }
        .pulse-loader {
            width: 60px; height: 60px; border-radius: 50%; background: var(--gold-gradient);
            margin: 0 auto 25px auto; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 30px var(--gold-glow); animation: breathe 2s infinite;
        }
        .pulse-loader i { font-size: 24px; color: #000; }
        
        .timer-display {
            font-size: 36px; font-weight: 700; color: #fff; margin: 20px 0;
            font-family: monospace; letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(255,255,255,0.1);
        }
        .info-text { font-size: 13px; color: var(--text-muted); line-height: 1.6; }

        /* Overlay */
        #checkingOverlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(5, 5, 5, 0.95); z-index: 50;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }

        @keyframes pulseGlow { 0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); } 50% { opacity: 0.6; transform: translate(-50%, -50%) scale(1.1); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes breathe { 0%, 100% { box-shadow: 0 0 20px var(--gold-glow); } 50% { box-shadow: 0 0 40px var(--gold-glow); } }

    </style>
</head>
<body>

    <div class="bg-glow"></div>

    <div class="container">
        <div class="glass-card">
            
            <!-- OVERLAY: Checking Status -->
            <div id="checkingOverlay">
                <div style="color:var(--primary-gold); font-size:30px; margin-bottom:15px;"><i class="fas fa-circle-notch fa-spin"></i></div>
                <div style="font-size:12px; letter-spacing:1px; color:#fff;">CHECKING STATUS...</div>
            </div>

            <!-- VIEW 1: FORM -->
            <div id="formSection">
                <div class="header-area">
                    <div class="logo-icon"><i class="fas fa-shield-alt"></i></div>
                    <h1 class="title">Secure Activation</h1>
                    <div class="subtitle">Complete Payment to Unlock Access</div>
                </div>

                <!-- Premium Wallet Box -->
                <div class="wallet-container">
                    <div class="wallet-label">
                        <span><i class="fas fa-wallet"></i> Send USDT (BEP20)</span>
                        <span style="color:#2ecc71; font-size:9px;">ACTIVE</span>
                    </div>
                    <div class="address-row">
                        <!-- REPLACE WITH YOUR ACTUAL WALLET ADDRESS -->
                        <div class="wallet-text" id="adminWallet">0x1234567890abcdef1234567890abcdef12345678</div>
                        <button class="copy-btn" onclick="copyAddress()">
                            <i class="far fa-copy" id="copyIcon"></i>
                        </button>
                    </div>
                    <div style="font-size:10px; color:#666; margin-top:8px; text-align:center;">
                        Network: <b>BNB Smart Chain (BEP20)</b>
                    </div>
                </div>

                <form id="activationForm">
                    <!-- Referral -->
                    <div class="form-group">
                        <label class="form-label">Referral Code</label>
                        <div class="input-box">
                            <input type="text" id="refId" class="form-input" value="Admin_Official" readonly>
                            <i class="fas fa-link input-icon"></i>
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <div class="input-box">
                            <input type="email" id="userEmail" class="form-input" placeholder="Enter your email address" required>
                            <i class="fas fa-envelope input-icon"></i>
                        </div>
                    </div>

                    <!-- Name -->
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <div class="input-box">
                            <input type="text" id="userName" class="form-input" placeholder="Enter account name" required>
                            <i class="fas fa-user input-icon"></i>
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div class="form-group">
                        <label class="form-label">Payment Method</label>
                        <div class="input-box">
                            <select id="paymentMethod" class="form-select">
                                <option value="USDT (BEP20)">USDT (BEP20)</option>
                            </select>
                            <i class="fas fa-coins input-icon"></i>
                        </div>
                    </div>

                    <!-- Sender Address -->
                    <div class="form-group">
                        <label class="form-label">Sender Wallet Address</label>
                        <div class="input-box">
                            <input type="text" id="senderAddress" class="form-input" placeholder="Paste your wallet address" required>
                            <i class="fas fa-paper-plane input-icon"></i>
                        </div>
                    </div>

                    <button type="submit" class="btn-gold" id="submitBtn">
                        CONFIRM PAYMENT <i class="fas fa-arrow-right"></i>
                    </button>
                </form>
            </div>

            <!-- VIEW 2: WAITING -->
            <div id="waitingScreen">
                <div class="pulse-loader"><i class="fas fa-hourglass"></i></div>
                <h2 class="title" style="font-size:18px;">Verification Pending</h2>
                <div class="info-text" style="margin-top:10px;">
                    We are verifying your transaction.<br>This usually takes a few minutes.
                </div>
                
                <div class="timer-display" id="timer">10:00</div>
                
                <div class="info-text" style="font-size:11px; padding:10px; background:rgba(255,255,255,0.05); border-radius:8px;">
                    <i class="fas fa-info-circle"></i> You can close this page.<br>
                    You will be automatically redirected to <b>Register</b> upon approval.
                </div>
            </div>

        </div>
    </div>

    <!-- Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, push, set, query, orderByChild, equalTo, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAPVw167yqxWRl6tckwTJ0w7nQgaHzoijk",
            authDomain: "affiliate-global-x-network.firebaseapp.com",
            databaseURL: "https://affiliate-global-x-network-default-rtdb.firebaseio.com",
            projectId: "affiliate-global-x-network",
            storageBucket: "affiliate-global-x-network.firebasestorage.app",
            messagingSenderId: "977862606652",
            appId: "1:977862606652:web:e7b9f58c9210da04972839"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- COPY FUNCTION ---
        window.copyAddress = function() {
            const text = document.getElementById('adminWallet').innerText;
            navigator.clipboard.writeText(text);
            
            const icon = document.getElementById('copyIcon');
            const originalClass = icon.className;
            
            // Visual Feedback
            icon.className = "fas fa-check";
            icon.style.color = "#000"; 
            
            setTimeout(() => {
                icon.className = originalClass;
                icon.style.color = "";
            }, 2000);
        }

        // --- INITIAL LOAD ---
        window.onload = function() {
            // Check URL parameters for Referral
            const urlParams = new URLSearchParams(window.location.search);
            const refParam = urlParams.get('ref');
            if(refParam) {
                document.getElementById('refId').value = refParam;
            }

            // Check Persistence (If user already submitted)
            const savedEmail = localStorage.getItem('user_email_lock');
            if (savedEmail) {
                document.getElementById('formSection').style.display = 'none';
                document.getElementById('checkingOverlay').style.display = 'flex';
                checkStatusAndRedirect(savedEmail);
            }
        };

        // --- SUBMIT FORM ---
        document.getElementById('activationForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const email = document.getElementById('userEmail').value.toLowerCase().trim();
            const name = document.getElementById('userName').value;
            const refCode = document.getElementById('refId').value;
            const method = document.getElementById('paymentMethod').value;
            const address = document.getElementById('senderAddress').value;
            const btn = document.getElementById('submitBtn');

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> PROCESSING...';

            const newRequestRef = push(ref(db, 'activation_requests'));
            set(newRequestRef, {
                email: email,
                userName: name,
                referralId: refCode,
                method: method,
                senderAddress: address,
                status: 'pending',
                timestamp: Date.now()
            })
            .then(() => {
                // Save state
                localStorage.setItem('user_email_lock', email);
                localStorage.setItem('submit_time', Date.now());
                
                // Switch UI
                document.getElementById('formSection').style.display = 'none';
                document.getElementById('waitingScreen').style.display = 'block';
                
                runTimer(); 
                checkStatusAndRedirect(email);
            })
            .catch((error) => {
                alert("Error: " + error.message);
                btn.disabled = false;
                btn.innerHTML = 'CONFIRM PAYMENT <i class="fas fa-arrow-right"></i>';
            });
        });

        // --- STATUS CHECKER ---
        function checkStatusAndRedirect(email) {
            const requestsRef = query(ref(db, 'activation_requests'), orderByChild('email'), equalTo(email));
            
            onValue(requestsRef, (snapshot) => {
                const data = snapshot.val();
                document.getElementById('checkingOverlay').style.display = 'none';

                if (data) {
                    // Get the most recent request for this email
                    const keys = Object.keys(data);
                    const request = data[keys[keys.length - 1]];

                    if (request.status === 'approved') {
                        // APPROVED
                        localStorage.removeItem('user_email_lock'); 
                        localStorage.removeItem('submit_time');
                        
                        document.body.innerHTML = `
                            <div style="display:flex; justify-content:center; align-items:center; height:100vh; background:#050505; color:#FFD700; flex-direction:column; font-family:'Outfit', sans-serif;">
                                <i class="fas fa-check-circle" style="font-size:60px; margin-bottom:20px; text-shadow:0 0 20px #FFD700;"></i>
                                <h2 style="text-transform:uppercase;">Payment Approved</h2>
                                <p style="color:#888;">Redirecting to Registration...</p>
                            </div>
                        `;
                        // Redirect to register.html
                        setTimeout(() => { window.location.href = 'register.html'; }, 2000);
                        
                    } else if (request.status === 'rejected') {
                        // REJECTED
                        localStorage.removeItem('user_email_lock');
                        alert("Your payment request was rejected. Please check details and submit again.");
                        location.reload();

                    } else {
                        // PENDING
                        document.getElementById('formSection').style.display = 'none';
                        document.getElementById('waitingScreen').style.display = 'block';
                        runTimer();
                    }
                } else {
                    // No data found (rare case if localstorage exists but DB cleared)
                    localStorage.removeItem('user_email_lock');
                    document.getElementById('formSection').style.display = 'block';
                }
            });
        }

        // --- TIMER ---
        function runTimer() {
            const timerDisplay = document.getElementById('timer');
            const startTime = localStorage.getItem('submit_time') || Date.now();
            const duration = 10 * 60 * 1000; // 10 minutes

            const interval = setInterval(() => {
                const now = Date.now();
                const remaining = duration - (now - startTime);

                if (remaining <= 0) {
                    timerDisplay.innerText = "00:00";
                    timerDisplay.style.color = "#ff4757"; 
                } else {
                    const m = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                    const s = Math.floor((remaining % (1000 * 60)) / 1000);
                    timerDisplay.innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
                }
            }, 1000);
        }

    </script>
</body>
</html>
